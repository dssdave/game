<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Town Explorer RPG</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #87ceeb; /* Sky blue background */
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        // Initialize canvas and context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const tileSize = 32; // Size of each tile in pixels
        let gameState = 'town'; // Current area (starts in town)
        let playerX = tileSize * 2; // Player's initial x position (pixels)
        let playerY = tileSize * 2; // Player's initial y position (pixels)
        const playerWidth = tileSize; // Player size matches tile for simplicity
        const playerHeight = tileSize;
        const speed = 4; // Movement speed in pixels per frame

        // Define maps for town and buildings
        const maps = {
            'town': {
                'grid': [
                    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,1,1,1,0,1,1,1,0,1,0,0,0,1],
                    [1,0,1,2,1,0,1,2,1,0,1,0,0,0,1],
                    [1,0,1,1,1,0,1,1,1,0,1,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,1,1,1,0,1,1,1,0,1,0,0,0,1],
                    [1,0,1,2,1,0,1,2,1,0,1,0,0,0,1],
                    [1,0,1,1,1,0,1,1,1,0,1,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
                ],
                'tileSet': {
                    0: 'green',    // Ground
                    1: 'gray',     // Walls
                    2: 'blue'      // Doors
                }
            },
            'shop': {
                'grid': [
                    [1,1,1,1,1],
                    [1,0,0,0,1],
                    [1,0,3,0,1],
                    [1,0,0,0,1],
                    [1,1,1,1,1]
                ],
                'tileSet': {
                    0: 'brown',    // Floor
                    1: 'gray',     // Walls
                    3: 'red'       // Exit door
                }
            },
            'house': {
                'grid': [
                    [1,1,1,1],
                    [1,0,0,1],
                    [1,0,3,1],
                    [1,1,1,1]
                ],
                'tileSet': {
                    0: 'purple',   // Floor
                    1: 'gray',     // Walls
                    3: 'red'       // Exit door
                }
            }
        };

        // Define door mappings (area transitions)
        const doors = {
            'town_3_3': ['shop', 2, 1],    // Town door 1 to shop
            'shop_2_2': ['town', 3, 3],    // Shop exit to town
            'town_7_3': ['house', 1, 1],   // Town door 2 to house
            'house_2_2': ['town', 7, 3],   // House exit to town
            'town_3_7': ['shop', 2, 1],    // Town door 3 to shop
            'town_7_7': ['house', 1, 1]    // Town door 4 to house
        };

        // Set initial map and canvas size
        let currentMap = maps[gameState];
        canvas.width = currentMap['grid'][0].length * tileSize;
        canvas.height = currentMap['grid'].length * tileSize;

        // Handle keyboard input
        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        // Check for collisions with walls
        function isColliding(rect) {
            const grid = currentMap['grid'];
            for (let row = 0; row < grid.length; row++) {
                for (let col = 0; col < grid[row].length; col++) {
                    if (grid[row][col] === 1) { // Wall tile
                        const tileX = col * tileSize;
                        const tileY = row * tileSize;
                        if (rect.x < tileX + tileSize &&
                            rect.x + rect.width > tileX &&
                            rect.y < tileY + tileSize &&
                            rect.y + rect.height > tileY) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        // Update game state
        function update() {
            let dx = 0;
            let dy = 0;
            if (keys['ArrowLeft']) dx -= speed;
            if (keys['ArrowRight']) dx += speed;
            if (keys['ArrowUp']) dy -= speed;
            if (keys['ArrowDown']) dy += speed;

            // Try horizontal movement
            let newX = playerX + dx;
            let horizontalRect = {x: newX, y: playerY, width: playerWidth, height: playerHeight};
            if (!isColliding(horizontalRect)) {
                playerX = newX;
            }

            // Try vertical movement
            let newY = playerY + dy;
            let verticalRect = {x: playerX, y: newY, width: playerWidth, height: playerHeight};
            if (!isColliding(verticalRect)) {
                playerY = newY;
            }

            // Keep player within map bounds
            playerX = Math.max(0, Math.min(playerX, canvas.width - playerWidth));
            playerY = Math.max(0, Math.min(playerY, canvas.height - playerHeight));

            // Handle door interaction
            if (keys[' ']) {
                let playerTileX = Math.floor((playerX + playerWidth / 2) / tileSize);
                let playerTileY = Math.floor((playerY + playerHeight / 2) / tileSize);
                let doorKey = `${gameState}_${playerTileX}_${playerTileY}`;
                if (doorKey in doors) {
                    let [targetArea, targetX, targetY] = doors[doorKey];
                    gameState = targetArea;
                    currentMap = maps[gameState];
                    // Update canvas size for new area
                    canvas.width = currentMap['grid'][0].length * tileSize;
                    canvas.height = currentMap['grid'].length * tileSize;
                    playerX = targetX * tileSize;
                    playerY = targetY * tileSize;
                }
            }
        }

        // Render the current area
        function draw() {
            // Clear the screen for a fresh transition
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the map
            const grid = currentMap['grid'];
            const tileSet = currentMap['tileSet'];
            for (let row = 0; row < grid.length; row++) {
                for (let col = 0; col < grid[row].length; col++) {
                    let tileType = grid[row][col];
                    ctx.fillStyle = tileSet[tileType];
                    ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
                }
            }

            // Draw the player
            ctx.fillStyle = 'red';
            ctx.fillRect(playerX, playerY, playerWidth, playerHeight);
        }

        // Main game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Start the game
        gameLoop();
    </script>
</body>
</html>
