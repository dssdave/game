<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princess Adventure</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #87ceeb;
        }
        canvas {
            border: 1px solid black;
            background-color: #7cfc00;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="640" height="480"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const tileSize = 32;
        let score = 0;
        let currentScene = 'town';

        // Maps
        const townMap = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        const castleMap = [
            [1,1,1,1,1,1,1],
            [1,0,0,0,0,0,1],
            [1,0,0,0,0,0,1],
            [1,0,0,2,0,0,1],
            [1,0,0,0,0,0,1],
            [1,0,0,0,0,0,1],
            [1,1,1,1,1,1,1]
        ];

        const houseMap = [
            [1,1,1,1,1],
            [1,0,0,0,1],
            [1,0,0,0,1],
            [1,0,2,0,1],
            [1,1,1,1,1]
        ];

        // Princess position
        let princess = {
            x: 5 * tileSize,
            y: 5 * tileSize,
            width: tileSize / 2,
            height: tileSize / 2,
            speed: 4
        };

        // Items
        let items = [
            {x: 100, y: 100, type: 'flower', points: 10, collected: false},
            {x: 150, y: 200, type: 'coin', points: 5, collected: false},
            {x: 300, y: 150, type: 'flower', points: 10, collected: false},
            {x: 400, y: 250, type: 'coin', points: 5, collected: false}
        ];

        // Doors
        let doors = {
            town: [
                {x: 10 * tileSize, y: 5 * tileSize, width: tileSize, height: tileSize, target: 'castle'},
                {x: 15 * tileSize, y: 10 * tileSize, width: tileSize, height: tileSize, target: 'house'}
            ],
            castle: [
                {x: 3 * tileSize, y: 3 * tileSize, width: tileSize, height: tileSize, target: 'town'}
            ],
            house: [
                {x: 2 * tileSize, y: 3 * tileSize, width: tileSize, height: tileSize, target: 'town'}
            ]
        };

        // Controls
        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        // Get current map
        function getCurrentMap() {
            if (currentScene === 'town') return townMap;
            if (currentScene === 'castle') return castleMap;
            if (currentScene === 'house') return houseMap;
        }

        // Check collision
        function checkCollision(x, y) {
            const map = getCurrentMap();
            const col = Math.floor(x / tileSize);
            const row = Math.floor(y / tileSize);
            if (row < 0 || row >= map.length || col < 0 || col >= map[0].length) return true;
            return map[row][col] === 1;
        }

        // Check item collection
        function checkItemCollection() {
            if (currentScene !== 'town') return;
            for (let item of items) {
                if (!item.collected &&
                    princess.x < item.x + tileSize &&
                    princess.x + princess.width > item.x &&
                    princess.y < item.y + tileSize &&
                    princess.y + princess.height > item.y) {
                    item.collected = true;
                    score += item.points;
                }
            }
        }

        // Check door interaction
        function checkDoorInteraction() {
            const currentDoors = doors[currentScene];
            for (let door of currentDoors) {
                if (princess.x < door.x + door.width &&
                    princess.x + princess.width > door.x &&
                    princess.y < door.y + door.height &&
                    princess.y + princess.height > door.y) {
                    currentScene = door.target;
                    if (currentScene === 'town') {
                        princess.x = 5 * tileSize;
                        princess.y = 5 * tileSize;
                    } else if (currentScene === 'castle') {
                        princess.x = 3 * tileSize;
                        princess.y = 2 * tileSize;
                    } else if (currentScene === 'house') {
                        princess.x = 2 * tileSize;
                        princess.y = 2 * tileSize;
                    }
                    return;
                }
            }
        }

        // Draw map
        function drawMap() {
            const map = getCurrentMap();
            for (let row = 0; row < map.length; row++) {
                for (let col = 0; col < map[row].length; col++) {
                    if (map[row][col] === 0) {
                        ctx.fillStyle = '#7cfc00'; // Grass
                    } else if (map[row][col] === 1) {
                        ctx.fillStyle = '#808080'; // Wall
                    } else if (map[row][col] === 2) {
                        ctx.fillStyle = '#0000ff'; // Door
                    }
                    ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
                }
            }
        }

        // Draw items
        function drawItems() {
            if (currentScene !== 'town') return;
            for (let item of items) {
                if (!item.collected) {
                    ctx.fillStyle = item.type === 'flower' ? '#ffff00' : '#ffa500';
                    ctx.fillRect(item.x, item.y, tileSize / 2, tileSize / 2);
                }
            }
        }

        // Draw princess
        function drawPrincess() {
            ctx.fillStyle = '#ff69b4'; // Pink body
            ctx.fillRect(princess.x, princess.y, princess.width, princess.height);
            ctx.fillStyle = '#ffd700'; // Yellow crown
            ctx.fillRect(princess.x + princess.width / 4, princess.y - princess.height / 4, princess.width / 2, princess.height / 4);
        }

        // Game loop
        function gameLoop() {
            // Handle movement
            let dx = 0;
            let dy = 0;
            if (keys['ArrowLeft']) dx -= princess.speed;
            if (keys['ArrowRight']) dx += princess.speed;
            if (keys['ArrowUp']) dy -= princess.speed;
            if (keys['ArrowDown']) dy += princess.speed;

            // Check collision
            const newX = princess.x + dx;
            const newY = princess.y + dy;
            if (!checkCollision(newX, princess.y)) princess.x = newX;
            if (!checkCollision(princess.x, newY)) princess.y = newY;

            // Check item collection and door interaction
            checkItemCollection();
            checkDoorInteraction();

            // Draw everything
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawMap();
            drawItems();
            drawPrincess();

            // Draw score
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);

            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
