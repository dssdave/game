<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princess Adventure - Enhanced Edition</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #87ceeb; /* Light blue sky */
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1024" height="1024"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const tileSize = 32; // Each tile is 32x32 pixels
        const mapSize = 32;  // 32x32 tile grid for a 1024x1024 canvas

        // Define the game map (0: grass, 1: wall, 2: water, 3: entrance)
        const map = Array.from({ length: mapSize }, () => Array(mapSize).fill(0));
        // Add walls, water, and entrances
        for (let i = 5; i < 10; i++) map[5][i] = 1; // Horizontal wall
        for (let i = 15; i < 20; i++) map[i][10] = 1; // Vertical wall
        map[8][8] = 2; // Water feature
        map[20][20] = 2; // Another water feature
        map[10][10] = 3; // Entrance to house
        map[15][15] = 3; // Entrance to castle

        // Princess properties
        let princess = {
            x: 1 * tileSize,
            y: 1 * tileSize,
            width: tileSize,
            height: tileSize,
            speed: 4 // Pixels per frame
        };

        // Handle keyboard input
        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);

        // Collision detection
        function isColliding(x, y) {
            const tileX = Math.floor(x / tileSize);
            const tileY = Math.floor(y / tileSize);
            if (tileX < 0 || tileX >= mapSize || tileY < 0 || tileY >= mapSize) return true;
            return map[tileY][tileX] === 1; // Wall
        }

        // Update princess position
        function updatePrincess() {
            let dx = 0;
            let dy = 0;
            if (keys['ArrowLeft']) dx -= princess.speed;
            if (keys['ArrowRight']) dx += princess.speed;
            if (keys['ArrowUp']) dy -= princess.speed;
            if (keys['ArrowDown']) dy += princess.speed;

            let newX = princess.x + dx;
            if (!isColliding(newX, princess.y) && !isColliding(newX + princess.width, princess.y)) {
                princess.x = newX;
            }

            let newY = princess.y + dy;
            if (!isColliding(princess.x, newY) && !isColliding(princess.x, newY + princess.height)) {
                princess.y = newY;
            }

            princess.x = Math.max(0, Math.min(princess.x, canvas.width - princess.width));
            princess.y = Math.max(0, Math.min(princess.y, canvas.height - princess.height));

            const tileX = Math.floor(princess.x / tileSize);
            const tileY = Math.floor(princess.y / tileSize);
            if (map[tileY][tileX] === 3) {
                console.log('Entered building at', tileX, tileY);
            }
        }

        // Draw the map
        function drawMap() {
            for (let row = 0; row < mapSize; row++) {
                for (let col = 0; col < mapSize; col++) {
                    const tile = map[row][col];
                    let color;
                    switch (tile) {
                        case 0: // Grass
                            color = `hsl(120, 50%, ${40 + Math.random() * 20}%)`; // Varied green
                            break;
                        case 1: // Wall
                            color = '#888'; // Gray wall
                            break;
                        case 2: // Water
                            color = 'blue';
                            break;
                        case 3: // Entrance
                            color = 'yellow';
                            break;
                    }
                    ctx.fillStyle = color;
                    ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
                }
            }
        }

        // Draw the princess
        function drawPrincess() {
            ctx.fillStyle = '#ff69b4'; // Pink gown
            ctx.fillRect(princess.x + 8, princess.y + 16, 16, 16);
            ctx.fillStyle = '#ffdab9'; // Skin tone
            ctx.beginPath();
            ctx.arc(princess.x + 16, princess.y + 8, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#8b4513'; // Brown hair
            ctx.fillRect(princess.x + 8, princess.y, 16, 8);
            ctx.fillStyle = '#ffd700'; // Gold crown
            ctx.fillRect(princess.x + 12, princess.y - 4, 8, 4);
        }

        // Main game loop
        function gameLoop() {
            updatePrincess();
            drawMap();
            drawPrincess();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
